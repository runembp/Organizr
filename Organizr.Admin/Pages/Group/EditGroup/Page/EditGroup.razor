@page "/EditGroup/{GroupId:int}"
@using Organizr.Application.Requests.Groups
@using Organizr.Domain.Entities

@attribute [Authorize]

<Tabs SelectedTab="@_selectedTab"
      SelectedTabChanged="@OnSelectedTab_Changed">
    <Items>
        <Tab Name="GroupInfo">
            Gruppe informationer
        </Tab>
        <Tab Name="Members">
            Medlemmer
        </Tab>
    </Items>
    <Content>
        <TabPanel Name="GroupInfo">
            <EditGroupInformation Group="@SelectedGroup" OnGroupEdited="@GroupContentHasChanged"/>
        </TabPanel>
        <TabPanel Name="Members">
            <MemberOverview Group="@SelectedGroup" OnMemberAdded="@GroupContentHasChanged"/>
        </TabPanel>
    </Content>
</Tabs>


@code {

    [Parameter]
    public int GroupId { get; set; }

    private MemberGroup? SelectedGroup { get; set; } = new();
    private string _selectedTab = "GroupInfo";

    protected override async Task OnInitializedAsync()
    {
        SelectedGroup = await Mediator.Send(new GetMemberGroupWithMembersByIdRequest {GroupId = GroupId});
    }

    private Task OnSelectedTab_Changed(string tabName)
    {
        _selectedTab = tabName;
        return Task.CompletedTask;
    }

    private Task GroupContentHasChanged()
    {
        StateHasChanged();
        return Task.CompletedTask;
    }

}