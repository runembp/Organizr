<Modal @ref="_addMemberModal">
    <ModalContent Centered>
        <ModalHeader>
            Tilføj medlem til @Group.Name
        </ModalHeader>
        <ModalBody>
            <Field>
                <FieldLabel>Vælg medlem: </FieldLabel>
                <Select TValue="int" @bind-SelectedValue="SelectedMember">
                    @foreach (var member in AllMembersList)
                    {
                        <SelectItem Value="member.Id">@member.FirstName @member.LastName</SelectItem>
                    }
                </Select>
            </Field>
        </ModalBody>
        <ModalFooter>
            <Div>
                <Button Color="Color.Primary" Clicked="OnAddMemberButton_Clicked">Gem</Button>
                <Button Color="Color.Secondary" Clicked="OnCancelButton_Clicked">Afbryd</Button>
            </Div>
            <br/>
            <Div>
                <Alert Color="Color.Danger" Visible="_addMemberError">
                    <AlertMessage>Medlemmet kunne ikke tilføjes til Gruppen</AlertMessage>
                </Alert>
            </Div>
        </ModalFooter>
    </ModalContent>
</Modal>

@code
{
    [Parameter]
    public MemberGroup Group { get; set; } = new();

    [Parameter]
    public EventCallback OnGroupContentChanged { get; set; }

    private List<Member> AllMembersList { get; set; } = new();
    private int SelectedMember { get; set; }
    private Modal? _addMemberModal;
    private bool _addMemberError;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            AllMembersList = await MemberService.GetAllMembers();
        }

        AllMembersList = AllMembersList.Where(x => !x.Groups.Contains(Group)).ToList();
    }

    public async Task Show()
    {
        await _addMemberModal!.Show();
    }

    private async Task OnAddMemberButton_Clicked()
    {
        _addMemberError = false;
        var result = await GroupService.AddMemberToGroup(Group.Id, SelectedMember);

        if (result is null)
        {
            _addMemberError = true;
            return;
        }

        Group = result;
        await _addMemberModal!.Hide();
        await OnGroupContentChanged.InvokeAsync();
    }

    private async Task OnCancelButton_Clicked()
    {
        await _addMemberModal!.Hide();
    }
}