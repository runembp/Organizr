<Row>
    <SearchBar/>
    <Row Style="padding: 2rem" Flex="Flex.JustifyContent.Around">
        <Button Color="Color.Primary" Clicked="OnAddMemberButton_Clicked">Tilføj Person</Button>
    </Row>
</Row>

<DataGrid TItem="Member"
          Data="Group.Members">
    <DataGridColumns>
        <DataGridColumn Field="@nameof(Member.Id)" Sortable="true" Caption="Id">
            <DisplayTemplate>
                <Button Clicked="() => OnEditMemberLink_Clicked(context.Id)" Color="Color.Link">@context.Id</Button>
            </DisplayTemplate>
        </DataGridColumn>
        <DataGridColumn Field="@nameof(Member.FirstName)" Sortable="true" Caption="Fornavn"/>
        <DataGridColumn Field="@nameof(Member.LastName)" Sortable="true" Caption="Efternavn"/>
        <DataGridColumn Field="@nameof(Member.Gender)" Sortable="true" Caption="Køn"/>
        <DataGridColumn Field="@nameof(Member.Address)" Sortable="true" Caption="Adresse"/>
        <DataGridColumn Field="@nameof(Member.PhoneNumber)" Sortable="true" Caption="Telefon"/>
        <DataGridColumn Sortable="true">Rolle</DataGridColumn>
        <DataGridColumn Field="@nameof(Member.Id)" Sortable="true" Caption="Administrer">
            <DisplayTemplate>
                <Button Clicked="() => OnRemoveMemberButton_Clicked(context.Id)" Color="Color.Danger">Slet</Button>
            </DisplayTemplate>
        </DataGridColumn>
    </DataGridColumns>
</DataGrid>

<MemberOverviewAddMemberModal @ref="_addMemberModal" Group="Group" OnGroupContentChanged="@OnMemberAdded"/>

<MemberOverviewRemoveMemberModal @ref="_removeMemberModal" Group="Group" OnGroupContentChanged="@OnMemberAdded" MemberToBeDeleted="MemberToBeDeleted"/>

@code {

    [Parameter]
    public MemberGroup Group { get; set; } = new();

    [Parameter]
    public EventCallback OnMemberAdded { get; set; }

    private MemberOverviewAddMemberModal? _addMemberModal;
    private MemberOverviewRemoveMemberModal? _removeMemberModal;
    private Member MemberToBeDeleted { get; set; } = new();

    private void OnEditMemberLink_Clicked(int memberId)
    {
        NavigationManager.NavigateTo($"/edit-member/{memberId}");
    }

    private async Task OnAddMemberButton_Clicked()
    {
        await _addMemberModal!.Show();
    }

    private async Task OnRemoveMemberButton_Clicked(int memberId)
    {
        MemberToBeDeleted = Group.Members.First(x => x.Id == memberId);
        await _removeMemberModal!.Show();
    }

}